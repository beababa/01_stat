---
title: "Mutivariées base (analyse factorielle)"
output:
  html_document:
    number_sections: yes
    toc: yes
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Attention définition !

On parle ici d'analyse factorielle. Il ne s'agit pas de facteur explicatif mais de
synthèse.




## En géométrie

Les axes factoriels rendent comptent le mieux possible de la
dispersion du nuage de points.

Un facteur regroupe des informations communes à plusieurs variables.

Le premier axe prend en compte le maximum d'information.

Le deuxième prend en compte le maximum d'information à partir des résidus du premier.

Et ainsi de suite ...

... d'où l'importance de l'informatique pour traiter du multicritère !



# La donnée

## Recherche

Comparaison donnée RPLS et insee à la base communes avec un outil très intuitif

https://statistiques-locales.insee.fr

Partir d'une hypothèse fictive autour du logement social. On a vu par exemple que

- l'année de construction ne permettait pas d'expliquer la surface habitable, 
ou que
- souvent les ménages les plus modestes n'obtenaient pas les grands appartements.

Quelles peuvent être les autres facteurs pour ces deux états de fait ?

Constituer le tableau à partir de l'outil.

Quels sont les zonages proposées ?

Quel serait une agrégation intéressante ? (essayer de faire l'échantillon proposé)

Attention, exporter en  .ods pour convertir en  .csv après. L'import en .csv direct
ne semble pas fonctionner.

Du coup, en profiter pour :

- supprimer les lignes inutiles
- raccourcir les libellés
- enregistrer en UTF-8 (c'est le format universel)

```{r}
data <- read.csv("data/data.csv", encoding = "UTF-8", dec = ",")
str(data)
# rownames
rownames(data) <- data [,1]
data <- data [,3:6]
pairs(data)
```

Qu'en pensez-vous ? Est-il possible de comparer ces variables ?

## Normaliser sa donnée

### Examen des valeurs de dispersion / centrales

Pour chaque variable, il faut chercher s'il n'y a pas de valeur aberrante.

"Les individus trop spécifiques brouillent le résumé." (Chaudule, p. 138)


```{r}
summary(data)
rownames(data)
# Suppression de Paris... voire d'autres dpts ?
data <- data [-76,]
```


Les coefficients de variation permettent également une première approche


```{r}
# suppression des NA
data[is.na(data$nb_emplois_LT ),]
data[is.na(data$diplôme ),]
data <- data [!is.na(data$nb_emplois_LT)|!is.na(data$diplôme),]
coeffVariation <- function (x) {mean(x)/sd(x)}
coeff <- sapply(data, coeffVariation)
sd <- sapply(data, sd)
moy <- sapply(data, mean)
tab <- cbind(moy,sd, coeff)
round(tab,0)
```



### Centrage et réduction


Il faut pouvoir comparer les valeurs des variables *indépendamment de l'unité originelle*

écart à la moyenne de la valeur / écart-type

2 opérations :

- centrage : écart à la moyenne (comme une translation graphique)

- réduction : division par l'écart type, on exprime la différence en écart-type (comme un 
changement d'échelle)


La variable standardisée a pour moyenne 0 et pour écart-type 1



```{r}
data_cr <- scale (data)
pairs(data_cr)
```

# Les calculs sous R


## Les axes factoriels

```{r}
acp <- prcomp(data_cr)
# par défaut direction négative on inverse
acp$rotation <- -1 * acp$rotation
acp$rotation
```

## Importance des axes

```{r}
acp$sdev^2 / sum(acp$sdev^2)
```

73 % de la variance pris en compte par le premier axe, etc...

Le premier axe résume la variation de la moitié des valeurs des 4 variables.

L'axe 3 a une haute valeur pour le logement.

Le nombre d'emploi et le diplôme sont liés et s'opposent au surlogement et aux
taux de natalité.


### Pour les individus (ici les départements)

```{r}
head(acp$x*-1)
biplot(acp, scale = 0)
```


Les départements proches suivent le même modèle de données. Leur position dans
le graphique montre leur rapport aux variables.

Dans le cas présent, les variables ne suivent pas les axes (problème des valeurs
aberrantes).

# Second traitement

Supprimer les valeurs posant problème et relancer les calculs. Essayer d'interpréter.

