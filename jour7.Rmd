---
title: "Multivariées"
output:
  html_document:
    number_sections: yes
    toc: yes
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(eval  = TRUE)
knitr::opts_chunk$set(echo  = TRUE)
knitr::opts_chunk$set(warning  = FALSE)
``` 


# Préparation de la donnée

On lit la donnée, on filtre sur Bondy

```{r}
data <- read.csv("data/data2022.csv", fileEncoding = "UTF-8", dec = ",")
names(data)
data <- data [data$INSEE_COM == '93010',]
```

On la met en forme au niveau des colonnes :

- colonne des % des inscrits

- récupération des noms des candidats

```{r}
ind <- grep("Ins", names(data))
pct <- data [, ind]
ind <- grep("Nom", names(data))
# la 1e ligne suffit
noms <- data [1,ind]
# on attribue les noms des candidats
names(pct) [c(7:18)] 
names(pct) [c(7:18)] <- noms
```

On retient uniquement l'abstention

```{r}
pct <- pct [,c(2, 7:18)]
names(pct) [1] <- "abst"
```

On attribue les numéros des bureaux

```{r}
rownames(pct) <- c(1:32)
```

On sauvegarde pour pouvoir l'utiliser à nouveau

```{r}
write.csv(pct, "data/pctBondy.csv", fileEncoding = "UTF-8")
```


# Exploration de la donnée

```{r}
pct <- read.csv("data/pctBondy.csv", fileEncoding = "UTF-8")
pct <- pct [,-1]
summary(pct)
cor(pct)
pairs(pct)
```

# ACP analyse en composante principale

```{r}
res <- prcomp(pct)
plot(res)
biplot(res)
```

Deux graphiques superposés : 

- cercle des corrélations (les candidats)

- nuage de points (les bureaux de vote)

On résume la donnée sur 2 axes seulement (PC1 et PC2)


Dans le cercle de correlations :

- longueur flèche (mauvaise / bonne représentation)

- position - proche / opposée - orthogonale (= aucune relation)

# Classification hiérarchique

```{r}
# matrice des distances
d.pct <- dist(pct)
cah <- hclust(d.pct)
plot(cah)
```

Dendrogramme avec matérialisation des groupes

```{r}
plot(cah)
rect.hclust(cah,k=4)
groupes.cah <- cutree(cah,k=4)
#liste des groupes
print(sort(groupes.cah))
```


# Deuxième approche

Deux directions possibles :

- on cherche les autres candidats

- on zoome sur certains bureaux de vote

## Les candidats

```{r}
names(pct)
pct <- pct [, c(2,3,5,7,9,10:13)]
```

Et on reproduit le code.

## Les bureaux de vote

On choisit un bureau dans chacun des 4 groupes : 3 15 29 13

```{r}
pct <- pct [c(3,15,29,13),]
```

Pour chaque graphique, faire une analyse 

Pourcentage d'information expliqué 

```{r}
plot(res)
# composantes principales
res$rotation
# écarts types
res$sdev
# variance
100 * res$sdev^2 / sum(res$sdev^2)   
```

