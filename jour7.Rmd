---
title: "Mutivariées base"
output:
  html_document:
    number_sections: yes
    toc: yes
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Attention définition !

On parle ici d'analyse factorielle. Il ne s'agit pas de facteur explicatif mais de
synthèse, de description.





# La donnée

Il s’agit d’émettre une hypothèse, mais aussi de rendre les variables comparables entre elles.

## Recherche

Comparaison donnée RPLS et insee à la base communes avec un outil très intuitif

https://statistiques-locales.insee.fr


### Exploration autour de l'outil

Chercher à construire un tableau au niveau des *communes* avec

![](img/statLocaleHasard.jpg)


Quels sont les outils de l'interface à utiliser ?


## Hypothèse multivariée

### La première


Formuler une hypothèse avec les 4 variables sélectionnées.

Par exemple, nous allons voir si le nombre d’entreprises a un lien avec - le nombre de résidences principales (recrutement local) - la part des non diplomes (les non diplomés vont sur un emploi proche) - et l’implantation des maisons france service (les maisons france service permettent le développement de l’emploi local)

(exercice moodle)

### Autour du logement social

Partir d'une hypothèse fictive autour du logement social. On a vu par exemple que

- l'année de construction ne permettait pas d'expliquer la surface habitable, 
ou que
- souvent les ménages les plus modestes n'obtenaient pas les grands appartements.

Quelles peuvent être les autres facteurs pour ces deux états de fait ?

Constituer le tableau à partir de l'outil.

```{r}
data <- read.csv("data/dataMultivarie.csv", encoding = "UTF-8", dec = ".", na.strings = "N/A")
# voir la structure du fichier
str(data)
# rownames
rownames(data) <- data [,1]
data <- data [,3:6]
pairs(data)
```
La donnée est trop lourde pour nos machines. On va juste le faire sur la région parisienne, c’est à dire les dpts 75, 77, 78, 91, 92, 93, 94, et 95


```{r}
data <- read.csv("data/dataMultivarie.csv", encoding = "UTF-8", dec = ".", na.strings = "N/A")
data$dpt <- substring(data$Code,1,2)
data <- data [data$dpt %in% c(75, 77, 78, 91, 92, 93, 94,95),]
```

Refaire les étiquettes et le pairs

```{r, echo = FALSE}
rownames(data) <- data [,1]
data <- data [,3:6]
pairs(data)
```



Qu’en pensez-vous ? Est-il possible de comparer ces variables ?

## Normaliser sa donnée

### Examen des valeurs de dispersion / centrales

Pour chaque variable, il faut chercher s'il n'y a pas de valeur aberrante.

"Les individus trop spécifiques brouillent le résumé." (Chaudule, p. 138)


```{r}
summary(data)
rownames(data)
# Suppression de valeur extrême nbEntreprises, autres suppressions ?
data [data$nbEntreprises > 500000,]
data <- data [data$nbEntreprises < 500000,]
```

Refaire la commande pairs

Les coefficients de variation permettent également une première approche


```{r}
data <- data [!is.na(data$nonDiplomes),]
coeffVariation <- function (x) {mean(x)/sd(x)}
coeff <- sapply(data, coeffVariation)
sd <- sapply(data, sd)
moy <- sapply(data, mean)
tab <- cbind(moy,sd, coeff)
round(tab,2)
```



### Centrage et réduction


Il faut pouvoir comparer les valeurs des variables *indépendamment de l'unité originelle*

écart à la moyenne de la valeur / écart-type

2 opérations :

- centrage : écart à la moyenne (comme une translation graphique)

- réduction : division par l'écart type, on exprime la différence en écart-type (comme un 
changement d'échelle)


La variable standardisée a pour moyenne 0 et pour écart-type 1



```{r}
data_cr <- scale (data)
pairs(data_cr)
```

## Les axes en géométrie

Les axes factoriels rendent comptent le mieux possible de la
dispersion du nuage de points.

Un facteur regroupe des informations communes à plusieurs variables.

Le premier axe prend en compte le maximum d'information.

Le deuxième prend en compte le maximum d'information à partir des résidus du premier.

Et ainsi de suite ...

... d'où l'importance de l'informatique pour traiter du multicritère !


![](img/axes.png)

# Les calculs sous R


## Les axes factoriels

```{r}
acp <- prcomp(data_cr)
# par défaut direction négative on inverse
acp$rotation <- -1 * acp$rotation
acp$rotation
```

## Importance des axes

```{r}
acp$sdev^2 / sum(acp$sdev^2)
```

73 % de la variance pris en compte par le premier axe, etc...

Le premier axe résume la variation de la moitié des valeurs des 4 variables.

L'axe 3 a une haute valeur pour le logement.

Le nombre d'emploi et le diplôme sont liés et s'opposent au surlogement et aux
taux de natalité.


### Pour les individus (ici les départements)

```{r}
head(acp$x*-1)
biplot(acp, scale = 0)
```


Les départements proches suivent le même modèle de données. Leur position dans
le graphique montre leur rapport aux variables.

Dans le cas présent, les variables ne suivent pas les axes (problème des valeurs
aberrantes).

# Second traitement

Supprimer les valeurs posant problème et relancer les calculs. Essayer d'interpréter.

