---
title: "Introduction"
output:
  html_document:
    number_sections: yes
    toc: yes
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(eval  = TRUE)
knitr::opts_chunk$set(echo  = FALSE)
knitr::opts_chunk$set(warning  = FALSE)
``` 


# Intitulé du cours

*"L5GEABIM Analyses bivariées et multivariées"*

```{r}
data <- read.csv("data/presentation.csv", encoding = "UTF-8", header = F)
knitr::kable(data, col.names = c("groupe", "heures", "enseignant") )
```


# Déroulé

Il va être modifié en fonction de

- votre vitesse - s'il faut prendre plus de temps sur les basiques
- mon enseignement - trois fois le même cours

A chaque cours un exercice à faire pour le prochain cours, quelque soit l'avancement du cours.
Utiliser les ressources internet, poser des questions,...




13 cours en tout. 
2 cours d'intro rappels stats
7 sur la stat bi-variée
3 sur la multivariée
1 cours pour un devoir sur table au mi-semestre

# Evaluation

- 1 devoir maison à rendre vers la fin du semestre
- 1 devoir sur table à la mi-semestre

... et c'est tout ! (pas de partiel)

Au départ on utilise Libre Office (plutôt que Microsoft) puis R

Question : quelle utilisation de R ? des cours cette année ?

```{r}
data <- read.csv("data/deroule.csv", encoding = "UTF-8")
knitr::kable(data)
```




# Présentation rapide (vous êtes nombreux !)


## Premier cours

passé / présent / futur
appétence pour les stats
fichier framapad, https://lite.framacalc.org/9pse-coursstatsorbonne2022-9we9

74 étudiants sur 3 cours

Attention, 5 doublons de prénoms (Ambre, Camille, Marie, Antonin et Sarah), j'ai rajouté l'initiale
du nom de famille.

```{r, echo=FALSE}
etudiant <-  read.csv("data/etudiant.csv", fileEncoding = "UTF-8")
mailetudiant <- paste(paste0(etudiant$mail, ";"))
tmp <- mailetudiant [1]
for (i in 2:73){ 
  tmp <- paste(tmp, mailetudiant [i])}
write.csv(tmp, "data/mails.txt")
tab <- table (etudiant$prénom)
names(tab)[tab >1]
write.csv(etudiant [, c("prénom", "groupe.TD")], "cours1.csv", fileEncoding = "UTF-8")
par(mar = c(2,16,2,4))
par(mfrow = c(3,2))
for (i in 3:7){
  par(mar = c(2,16,2,4))
  barplot(sort(table(etudiant [,i])), border = NA,
          horiz = T, las = 2, cex.names = 0.8, 
          main = names (etudiant) [i])
}
```


## Présence et rendu des devoirs : chiffres clés

### Effectif et cours

```{r, echo = FALSE}
tab <- table(etudiant$groupe.TD)
```


```{r,  echo = FALSE}
i <- 2
for (i in 2:5) {
  nomFic <- paste0("data/cours", i, ".csv")
  data <- read.csv(nomFic, fileEncoding = "UTF-8")
  data <- data [data [,3] == "oui",]
  tmp <- table(data$groupe.TD)
  tab <- rbind(tab , tmp)
  }
row.names(tab) <- c("cours1", "cours2", "cours3", "cours4", "cours5")
knitr::kable(tab)
barplot(tab, beside = T, main = "nombre d'étudiants par groupe et par cours", xlab = "groupe", ylab = "nb", col = terrain.colors(5) 
        , border = NA, legend =  T)
```


Désormais le framapad sert à l'émargement
https://lite.framacalc.org/9pse-coursstatsorbonne2022-9we9


### Les rendus d'exercices
```{r}
rendu <- c(47,36, 29, 14,14)
titre <- c("distribution", "univarié", "khi2", "khi2bis", "regression")
p <- barplot(rendu, names = titre, main = "rendu devoirs (effectif 75 étudiants environ)", border = NA)
text(p, y = rendu - 1, labels = rendu )
```


#### Les notes des exercices


- Le critère externe : des points faciles ?


Au 3e devoir, sur 29 rendus, la moitié (15) ne mettent pas le bon nom, ni la bonne extension.
Au 4e, sur 14, 10 ont utilisé bon nom et bonne extension.

- Distribution des totaux

```{r}
devoir <- read.csv("data/notes.csv", fileEncoding = "UTF-8", dec=",", na.strings = '-')
res <- (apply(devoir [,2:5], 1, sum, na.rm = T))
resSansZero <- res [res  !=0]
min(resSansZero)
densite <- density(res)
densite2 <- density(resSansZero)
hist(res, main = "Répartion du cumul des notes des 4 devoirs (max 17, 87 obs)", 
     xlab = "notes", ylab = "nb", freq = T,border = NA)
abline(v = mean(res),  col = "red")
abline(v = median(res),  col = "red", lty = 2)
hist(resSansZero, main = "Sans zéro (59 obs)", freq = T,border = NA,
     xlab = "notes", ylab = "nb")
abline(v = mean(resSansZero),  col = "red")
abline(v = median(resSansZero),  col = "red", lty = 2)
```

Beaucoup de notes très faibles, mais pas seulement.

# La donnée du cours

## La source
https://www.data.gouv.fr/fr/datasets/repertoire-des-logements-locatifs-des-bailleurs-sociaux/

### 2021

Prendre le .zip de 2021, petit test d'ouverture sous moodle (Introduction/bases informatiques)

```{r, eval=FALSE}
data <- read.csv("data/gros/rpls2021_geolocalise_OD_REG11_DEP93.csv", sep =";")
# distribution par commune
tab <- table(data$LIBCOM)
png("img/rpls93.png")
par(mar = c(10,4,2,2))
barplot(sort(tab), las = 2, border = NA, cex.names = 0.7)
abline(tab [ names(tab) == "Bondy"],0, col ="red")
dev.off()
write.csv(sort(tab), "data/dpt93RPLSCommune.csv")
# filtre sur Bondy
filtre <- data [data$LIBCOM == "Bondy",]
write.csv(filtre, "data/rplsBondy.csv")
```


![](img/rpls93.png)

C'est normalement ce fichier de données que nous allons utiliser pour le cours.


### 2019

Il y a un problème sur la donnée, prendre plutôt le millésime 2019


```{r}
rpls2019 <- read.csv2("data/gros/RPLS2019_detail_IDF_DEP_93.csv")
head(rpls2019)
rpls2021<- read.csv2("data/gros/rpls2021_geolocalise_OD_REG11_DEP93.csv")
```

```{r}
library(sf)
rpls2019 <- rpls2019 [rpls2019$CODEPOSTAL == '93140',]
rpls2021 <- rpls2021 [rpls2021$CODEPOSTAL == '93140',]
# spatialisation des données
rpls2019 <- st_as_sf(rpls2019, coords = c("X", "Y"), crs = 2154)
rpls2021 <- st_as_sf(rpls2021, coords = c("X", "Y"), crs = 2154)
write.csv(rpls2019, "data/rpls2019.csv", fileEncoding = "UTF-8")
st_write(rpls2019, "data/data.gpkg", "rpls2019", delete_layer = T)
st_write(rpls2021, "data/data.gpkg", "rpls2021", delete_layer = T)
```


```{r}

library(mapsf)
mf_map(rpls2019, pch= 20, col = "red")
mf_map(rpls2021, col = "green", alpha = 0.8, add = T)
mf_legend(type = "typo", pos = "topright", val = c("2019", "2021"), pal = c("red", "green"), border = NA,
          title = "")
mf_layout("Comparaison rpls 2019 et 2021", credits = "RPLS")
```


# Pratique

Lorsque l'exercice le requiert, le fichier est à rendre avec son *prénom* (toujours le même svp) sous moodle.



# Ressources autre que la bibliographie officielle

2 cours universitaires disponibles sur internet

- http://www.ipt.univ-paris8.fr/vgodard/enseigne/statisti/framstat.htm
- http://grasland.script.univ-paris-diderot.fr/STAT98/STAT98.htm



# Le devoir maison

A définir le 21/11
